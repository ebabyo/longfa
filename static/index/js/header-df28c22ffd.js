require(["KUYU.Service","KUYU.Binder","KUYU.Store","KUYU.userInfo","juicer","KUYU.plugins.alert"],function(){function e(e){for(var t=0,o=0; o<e.length; o++){var a=e.charCodeAt(o);a>=1&&a<=126||65376<=a&&a<=65439?t++:t+=2}return t}var t=KUYU.Service,o=(KUYU.RootScope,KUYU.Binder,KUYU.userInfo),a=KUYU.Init,i=(KUYU.Init.getEnv(),KUYU.Init.getJsHost()),n=KUYU.Store,s=KUYU.Init.getParam();KUYU.Init.getService();a.cookie(),$path=window.location.origin;var r=$("#GLOBAL_UUID").val(),c="",d="",l={getTopBar:function(){$("#top_bar_nav"),$(".wechat_box");$(document).on("mousemove",".wechat_box",function(){$(this).find("a").css("color","#FFFFFF"),$(".wechat").show()}).on("mouseout",".wechat_box",function(){$(this).find("a").css("color","#CCC"),$(".wechat").hide()}).on("mousemove",".wechat",function(){$(this).find("a").css("color","#FFFFFF"),$(".wechat").show()}).on("mouseout",".wechat",function(){$(this).find("a").css("color","#CCC"),$(".wechat").hide()}),t.get({url:i+"/rest/homePage/getActiveTopBars?terminalType=01",success:function(e){var t=$("#topads");if(e.retData&&0==e.code){var o=e.retData;if(o.imgUrl){t.html("<div class='divs'><a href="+o.url+" id='topads_background' target='_blank'></a><i id='t-event-close'>×</i></div>"),t.css({height:"85px"});var a=$("#t-event-close");$("#topads_background").css({background:"url("+o.imgUrl+") center center no-repeat",height:"85px"}),a.on("click",function(e){t.fadeOut(300)})}}}})},hovera:function(){$(document).on("mousemove",".top-bar-wrap li",function(){$(this).find("a").css("color","#FFFFFF")}),$(document).on("mouseout",".top-bar-wrap li",function(){$(this).find("a").css("color","#CCC")})},menuHover:function(){!function(){var e=$(".mes"),t=$(".li"),o=$(".menu-list"),a=$(".menu_line"),i=0,n=null,s=function(e,t,o){e.show(),t?(i=t.parent().offset().left,e.css({width:t.outerWidth(),bottom:"-10px",left:Math.floor(t.offset().left-i)})):e.css({width:0,bottom:"-24px",left:"0px"})};$.each(e,function(e,i){var r=t.eq(e),c=$(this);o.height(r.outerHeight()),$(this).on("mouseover",function(){n&&(clearTimeout(n),n=null),s(a,c),t.hide(),r.show(),0!=c.data("id")&&$(this).data("id")==r.data("id")?o.slideDown():o.slideUp(120)}),$(this).on("mouseout",function(){n=setTimeout(function(){s(a),t.eq(e).hide(),o.slideUp(120),n=null},100)}),t.eq(e).on("mouseover",function(){n&&(clearTimeout(n),n=null)}),t.eq(e).on("mouseout",function(){n=setTimeout(function(){s(a),t.eq(e).hide(),o.slideUp(120),n=null},100)})})}();var e=$(".menu"),t=$(".header_img");e.on("mouseover",function(e){$.each(t,function(e,t){var o=$(t);if(o.attr("data-o")){var a=new Image;a.src=o.attr("data-o"),o.data("load")||(a.onload=function(){o.attr("src",o.attr("data-o")),o.data("load",!0)})}})}),$(".header_img").lazyload({effect:"fadeIn"})},bannerpic:function(){t.get({url:i+"/rest/bannerpic/getBannerPictures?pageNo=562bf352698e0fdd&platform=platform_tcl_shop&terminalType=01",data:{},success:function(e){if("0"==e.code&&e.data[0]){var t=e.data[0];$(".act-box").show(),$(".act-box").html("<a href="+t.link+"></a>"),$(".act-box a").html("<img src="+t.url+">"),$(".menu-wrap .menu").css("marginLeft","139px")}}})},topSearch:function(){function e(e){var t=$(".input-list");if(window.location.href.indexOf("search/search")>-1){var o=sessionStorage.getItem("keyword");o&&$(".ser-input").val(o)}$(document).on("focus",".ser-input",function(o){$(this).attr("placeholder",""),sessionStorage.removeItem("keyword"),o.stopPropagation(),e&&t.text()&&t.show()}),$(document).on("click",".input-list li",function(e){var t=$(this).find("a").attr("key"),a=$(".input-list");sessionStorage.setItem("keyword",t),a.hide(),$(".ser-input").val(o),a.html(""),e.stopPropagation()}),$(document).on("blur",".ser-input",function(){""==$.trim($(this).val())&&$(this).attr("placeholder",c),setTimeout(function(){t.hide()},200)}),$(".ser-input").on("keydown",function(e){if(13==e.keyCode){var t=$(".ser-input").val();""==$.trim(t)?(sessionStorage.setItem("keyword",c),window.location.href=d||i+"/search/search?keyword="+encodeURIComponent(c)+"&sortBy=sortWeight"):(sessionStorage.setItem("keyword",t),window.location.href=i+"/search/search?keyword="+encodeURIComponent(t)+"&sortBy=sortWeight")}}),$(document).on("click",".sear",function(e){e.stopPropagation();var t=$(".ser-input").val();""==$.trim(t)?(sessionStorage.setItem("keyword",c),window.location.href=d||i+"/search/search?keyword="+encodeURIComponent(c)+"&sortBy=sortWeight"):(sessionStorage.setItem("keyword",t),window.location.href=i+"/search/search?keyword="+encodeURIComponent(t)+"&sortBy=sortWeight")})}function o(t){$.get(KUYU.Init.getService().dev+"/front/product/pc/hotkeyword?platformUuid=platform_tcl_shop&word="+t+"&type=0",function(t){var o=$(".input-list"),t=t.retData,a="";t&&t.length?($.each(t,function(e,t){a+='<li><a target="_blank" href="/search/search?keyword='+t.unionWord+'&sortBy=sortWeight" key='+t.unionWord+">"+t.unionWord+' <i class="scCount">约有'+t.hitCount+"件</i></a></li>"}),o.html(a).show()):o.html("").hide(),e(t)})}!function(){t.get({url:i+"/rest/front/product/keyword",data:{terminalType:"01",platformUuid:"platform_tcl_shop"},success:function(e){var t=0;c=e.retData[t]&&e.retData[t].searchWord?e.retData[t].searchWord:"电视",d=e.retData[t]&&e.retData[t].keyWordUrl?e.retData[t].keyWordUrl:"",$(".ser-input").attr("placeholder",c),setInterval(function(){t++,t>=e.retData.length&&(t=0),c=e.retData[t]&&e.retData[t].searchWord?e.retData[t].searchWord:"电视",$(".ser-input").attr("placeholder",c),d=e.retData[t]&&e.retData[t].keyWordUrl?e.retData[t].keyWordUrl:""},1e4)}})}(),$(document).on("keyup",".ser-input",function(e){e.stopPropagation();var t=($(this),$(".ser-input").val());setTimeout(function(){o(t)},300)}),e("")},userInof:function(){o(function(o){var i=$("#nav-right");if(o.code==CODEMAP.status.success){var n=window.location.href;-1!=n.indexOf("?couponUrl=cart/downLoadCouponUrl")&&(n=n.replace("?couponUrl=",""),window.location.replace(n));var s=JSON.stringify(o.data);sessionStorage.setItem("userinfo",s);var c=o.data.customerName?o.data.customerName:"";e(c)>=8&&(c=c.substr(0,8)+"..."),$("#span_customerName").html(c).data("title",o.data.customerUuid);var d=juicer('<li class="wechat_box"><a href="###">微信商城</a>  <div class="wechat"><img src="/app/images/wechat.jpg"><p>关注公众号<br>一键下单购买</p></div> </li><i></i><li><a href="/pages/orderList/orderList.html">我的订单</a></li><i></i><li class="index_cart_li"><a class="index_cart shoping" href="javascript:;" >购物车</a><span  class="newheader-circle" id="newhead_cart">( 0 )</span></li><i></i><li class="index_cus_id" ><a href="javascript:;" id="onlyName" data-id=${customerUuid}  >{@if nickName} ${nickName} {@else} ${customerName}{@/if}</a><em class="arrow webfont">&#xe608;</em><div class="info clearfix"><div class="infotop clearfix"><a href="http://user.tcl.com/proxy/user/information"><img src={@if customerImgUrl} ${customerImgUrl} {@else}../../app/images/adm.png{@/if}></a><div class="inforight"><div class="p1"><span class="user_name" title="{@if nickName} ${nickName} {@else} ${customerName}{@/if}">{@if nickName} ${nickName} {@else} ${customerName}{@/if}</span><span><img id="userlevel"/></span></div><div class="p2"><span>积分</span> <a id="userjifen" href="http://user.tcl.com/proxy/integral" title=${jifen} >${jifen}</a>　<span>优惠券 </span> <a href="/pages/coupondetails/coupondetails.html" title=${coupon} >${coupon}</a></div></div></div><div class="infobom clearfix"><a href="http://user.tcl.com/proxy/home/index"><span>个人中心</span></a><a href="http://hy.tcl.com/account/product/myproduct.html"><span>我的产品<span></span></a><a href="http://user.tcl.com/proxy/equity/index"><span>我的权益<span></span></a><a href="http://user.tcl.com/proxy/my/collection/goods"><span>我的收藏</span></a><a href="http://user.tcl.com/proxy/user/information" target="_blank"><span>账号管理</span></a><a href="/pages/productappraise/productappraise.html#productappraise"><span>评价管理<span></span></a><a id="exit" href="javascript:;"><span>退出登录</span></a></div></div></li>',o.data);i.html(d),"T1"==o.data.level||"T0"==o.data.level||"铁粉T1"==o.data.level||"铁粉T0"==o.data.level?$("#userlevel").attr("src","../../app/images/Artboard1.png"):"T2"==o.data.level||"铁粉T2"==o.data.level?$("#userlevel").attr("src","../../app/images/Artboard2.png"):"T3"==o.data.level||"铁粉T3"==o.data.level?$("#userlevel").attr("src","../../app/images/Artboard3.png"):"T4"==o.data.level||"铁粉T4"==o.data.level?$("#userlevel").attr("src","../../app/images/Artboard4.png"):"T5"!=o.data.level&&"铁粉T5"!=o.data.level||$("#userlevel").attr("src","../../app/images/Artboard5.png"),$(".shoping ").click(function(){a.nextPage("cart",{})});var u=$("#onlyName"),p=$(".info"),h=null;u.on("mouseover",function(e){clearTimeout(h),p.show()}),u.on("mouseout",function(e){h=setTimeout(function(){p.hide()},300)}),p.on("mouseover",function(e){clearTimeout(h)}),p.hover(function(){clearTimeout(h)},function(){h=setTimeout(function(){p.hide()},300)}),i.on("click","#exit",function(){t.get({url:"/tclcustomer/logout",success:function(e){e.code==CODEMAP.status.success||e.code==CODEMAP.status.TimeOut||103==e.code?(localStorage.removeItem("_ihome_token_"),localStorage.removeItem("ssoInject_first_time"),localStorage.removeItem("CartNum"),$.removeCookie("_ihome_token_"),$.removeCookie("fanliCookie"),window.location.href="/home"):Msg.Alert("","退出失败",function(){})}})}),l.getCartCount("login"),r?l.GETKF(r,o):(console.log("kefu2"),l.GETKF(null,o))}else o.code!=CODEMAP.status.notLogin&&o.code!=CODEMAP.status.TimeOut&&103!=o.code||(a.nextPage("Index",{}),localStorage.removeItem("_ihome_token_"),$.removeCookie("ihome-token",{path:"/"}),$.removeCookie("fanliCookie",{path:"/"}))})},getCartCount:function(e){var o=localStorage.getItem("CartNum");o&&parseInt(o)?$("#newhead_cart").text("( "+o+" )"):$("#newhead_cart").text("( 0 )"),window.attachEvent||window.addEventListener("setItemEvent",function(e){"CartNum"==e.key&&$("#newhead_cart").text("( "+e.val+" )")}),e&&function(){t.post({url:"/cart/count",success:function(e){0==e.code&&0!=e.data&&$("#newhead_cart").text("（"+e.data+"）")}})}()},GETKF:function(e,t){var o=s.keyword,a={};if(t&&(a.Uid=t.data.customerUuid,a.uname=t.data.nickName?t.data.nickName:t.data.customerName),0!=$("#categoryUuid").length){var i=$("#categoryUuid").val(),n={"456a4e26d34540eab1b31c7212a5fd98":"电视","821d80c65c60436fa721b006d89ff1b1":"智能硬件","325fe3718b3f4d4f8abe611373df821a":"空调",bbef5c0d59e74f04a1aadcc8003d9511:"冰箱","51dc2554485d4c549503a63298c34fae":"洗衣机","778c3418ca0a459b925a1edd09620c88":"健康电器"};NTKF_PARAM={siteid:"kf_9428",settingid:"kf_9428_1477382778975",uid:a.Uid,uname:a.uname,isvip:"0",userlevel:"1",ntalkerparam:{category:n[i]}}}else NTKF_PARAM=e?{siteid:"kf_9428",settingid:"kf_9428_1477382778975",uid:a.Uid,uname:a.uname,isvip:"0",userlevel:"1",itemid:e,itemparam:"pc_Product"}:o?{siteid:"kf_9428",settingid:"kf_9428_1477382778975",uid:a.Uid,uname:a.uname,isvip:"0",userlevel:"1",erpparam:"abc",ntalkerparam:{category:o,brand:""}}:{siteid:"kf_9428",settingid:"kf_9428_1477382778975",uid:a.Uid,uname:a.uname,isvip:"0",userlevel:"1"};$(function(){var e=['<div class="goTop">','            <a href="javascript:void(0);" onclick="NTKF.im_openInPageChat(\'kf_9428_1477382778975\')">','                <div class="item"></div><div class="item-1">客服</div>',"            </a>",'\t\t\t<a onclick="$(\'body,html\').animate({scrollTop: 0 },500);"><div class="item"></div><div class="item-1">顶部</div></a>',"\t\t</div>"].join("");"/page/ueCenter/ueCenter"!=window.location.pathname&&$("body").append(e),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==location.protocol?"https:":"http:")+"//dl.ntalker.com/js/xn6/ntkfstat.js?siteid=kf_9428";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()})},getCoupons:function(){t.get({url:i+"/rest/homepage/couponpromotion/getActives?terminalType=01&_"+Math.random(),success:function(e){if(null!=e.retData&&0==e.code){var t=e.retData;if(0==t.length)return!1;var o=$("<div id='tclActivity'></div><div id='shadowtcl'><div id='shadowBox'><span class='shadowBoxClose'>×</span><div class='shadowBoxList'></div>"+(t[0]?'<div class="shBxGoWrap clearfix"><div class="shBxGo shBxGoYellow" onClick="KUYU.$scope.coupongo(this)" name='+t[0].url+'>我的优惠券</div><div class="shBxGo shBxGoRed" onClick="KUYU.$scope.gogo(this)" name='+t[0].url+">马上去逛逛</div></div></div></div>":""));$("#tclActivity").length<1&&$("body").append(o);var a=t[0],i=$("<div id='tclActivityIcon'><span>×</span><img class='index-yhq-shou' src='/app/images/index-yhq-shou.png'/><img class='index-yhq-active' src="+a.imageUrl+"></div>");$("#tclActivity").append(i);var s=$("#tclActivityIcon"),r=$("#shadowtcl"),c=($("#shadowBox"),$("#shadowBox .shadowBoxClose"));$("#shadowBox .shadowBoxList"),$("#shadowBox .shBxGo");s.on("click","span",function(e){$("#tclActivityIcon span").hide(),$("#tclActivityIcon .index-yhq-active").hide(),$("#tclActivityIcon .index-yhq-shou").show()}),$("#tclActivityIcon .index-yhq-shou").on("hover",function(){$("#tclActivityIcon .index-yhq-active").show(),$("#tclActivityIcon .index-yhq-shou").hide(),$("#tclActivityIcon span").show()}),s.on("click","img",function(e){r.show(),l.getCouponsList()}),2==n.get("m18")&&(r.show(),l.getCouponsList(),n.remove("m18")),c.on("click",function(e){r.hide()})}}})},getCouponsList:function(){t.get({url:i+"/rest/homepage/promotioncoupons/getActives?terminalType=01&_"+Math.random(),success:function(e){if(0==e.code){var t=e.retData;if(0==t.length)return!1;t.length>=4&&$(".shadowBoxList").css({"overflow-y":"scroll",width:"1020px"});var o="";$.each(t,function(e,t){o+='<div class="row clearfix"><div class="tc-left">'+t.price+'<em>&nbsp;元</em></div><div class="tc-right"><div class="note" '+(t.secondNote?"":'style="padding-top:13px; padding-bottom:13px;"')+'><div class="titel">满'+t.couCondition+'元可使用</div><div class="note1" style="color:#999">'+t.firstNote+'</div><div class="note1"  '+(t.secondNote?'style="color:#999"':'style="display:none"')+">"+t.secondNote+'</div></div><button onclick="KUYU.$scope.checkJf('+t.convertIntegral+',this)"  name='+(t.state,t.couponUuid)+' class="btn'+(t.state,"")+'">'+(t.state,"立即领取")+"</button></div></div>"}),$("#shadowBox .shadowBoxList").html(o),$("#shadowBox .shadowBoxList .row:even").css({marginLeft:"-5px",marginRight:"5px"})}}})}};l.topSearch(),a.Ready(function(){function e(){var e={};if(n.get("shoppingcart")){var o=n.get("shoppingcart"),a=JSON.parse(o),i=a?a.storeMap["03d03b6b05604c5cb065aef65b72972e"]:[],s={},r={};$.each(i,function(e,t){r[t.storeUuid]=[]}),$.each(i,function(e,t){r[t.storeUuid]&&r[t.storeUuid].push(t)}),s.storeMap=r,e.storeMap=r}else e.storeMap={};t.post({url:"/login/mergeCart",data:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=UTF-8"},success:function(e){e.code==CODEMAP.status.success&&(o&&window.location.href.indexOf("cart.html")>0&&window.location.reload(),n.remove("shoppingcart"),window._gsTracker&&_gsTracker.track("/targetpage/loginOk"),1==n.get("m18")&&n.set("m18",2))}})}l.getTopBar(),l.hovera(),l.menuHover(),l.bannerpic();var o=function(t){if(-1!=t.status&&t.code){var o=localStorage.getItem("_ihome_token_")?localStorage.getItem("_ihome_token_"):null;$.ajax({url:"/rest/ssologin/check",type:"get",headers:{"ihome-token":o},data:{code:t.code},success:function(t){t.code==CODEMAP.status.success&&(localStorage.setItem("_ihome_token_",t.token),l.userInof(),e())}})}else n.get("_ihome_token_")||$.cookie("_ihome-token_")?l.userInof():(r?l.GETKF(r):(console.log("kefu1"),l.GETKF()),l.getCartCount())};cb=function(e){o(e)};$("body").append("<script src='https://user.tcl.com/sso/account/verifyUsernameToken?client_id=14046695&funcName=cb&_=0.9551350469412601'><\/script>"),l.getCoupons(),KUYU.$scope={},KUYU.$scope.checkJf=function(e,t){e&&e>0?Msg.Confirm("","领取该优惠券，需抵扣积分值"+e,function(){KUYU.$scope.as(t)},function(){}):KUYU.$scope.as(t)},KUYU.$scope.as=function(e){var o=$(e).attr("name");if(!o)return!1;if(!n.get("_ihome_token_"))return n.set("m18",1),window.location.href="http://user.tcl.com/proxy/login",!1;var a=i+"/cart/downLoadCoupon?random="+Math.random();t.get({url:a,data:{couponTypeUuid:o,ranNum:Math.random()},success:function(e){"0"==e.code?Msg.Alert("","领取成功",function(){l.getCouponsList()}):"3"==e.code?Msg.Alert("","您已经领取过了",function(){}):Msg.Alert("",e.msg,function(){})},error:function(e){throw e}})},KUYU.$scope.gogo=function(e){e?window.location.href=$(e).attr("name"):Msg.Alert("","找不到相关链接",function(){})},KUYU.$scope.coupongo=function(){n.get("_ihome_token_")?window.location.href="/pages/coupondetails/coupondetails.html#coupondetails":(n.set("m18",1),window.location.href="http://user.tcl.com/proxy/login")}}),function(){var e=location.href,t=$(".index_login"),o=$(".index_reg"),a=t.attr("href"),i=o.attr("href");t.attr("href",a+"?from="+e),o.attr("href",i+"?from="+e)}(),KUYU.toSearch=function(e){window.location.href="/search/search?keyword="+e+"&sortBy=sortWeight"};var u=$(".fans-item");$.each(u,function(e,t){(e+1)%4==0&&$(this).css("margin-right","0")}),_APP.inject("KUYU.Header",l)});